# RtMidi

Unity 用 RtMidi プラグインを開発するにあたっての覚え書き。

## テストコード

- MIDI-In について、ポーリングとコールバックを一つにまとめてしまいたい。
  - 動的切り替えは UI を作るのが面倒なので、bool プロパティによる切り替えで良いと思う。

## ビルドツール

- せめて Makefile にまとめたい

## 静的リンク問題

- 依存関係の解決を単純化したくて、色々と標準ライブラリを静的リンクしている。
  - Android における libstdc++
  - Windows における libgcc
  - 全ツッパで良いか？

## IL2CPP

- IL2CPP 下では C# delegate を関数ポインタに変換することが許されておらず、MIDI Callback を使うことができない。
  - static メソッドへのコールバックであれば恐らく許されているのでは？実験の必要あり。
  - いずれにせよ、polling 方式であれば問題無く使える。

## Android

### 問題点

- 実行中に MIDI デバイスを抜くとクラッシュする
  - "MidiInAndroid::pollMidi: error receiving MIDI data" とのエラーメッセージが出ている。
  - ポーリングスレッド内でエラーが発生し、そこから例外が投げられているが、それを受け取る者がいない。
  - rtmidi_c では逐一例外をキャッチしているが、ポーリングスレッドは手を出せない領域なので止まってしまう。
  - error callback の設定をできるようにするべきか？ これはちょっとした改修になるため、まだあまり手を出したくない。
