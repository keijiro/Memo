# ノイズ関数

様々な使い道のあるノイズ関数。実装のバリエーションも幅広く、色々混乱してきたので、まとめてみる。

## Value Noise vs Gradient Noise

Value noise の見た目の悪さは視覚化した際に明らかだが、そもそも何が問題なのか。

- 周波数成分を絞り込むことができないので、低周波成分だけの「滑らかなノイズ」を作ることができない。また、フラクタルノイズにも使えない。
- 画像や動きにノイズを用いる場合、Gradient Noise の持つ周期性が好ましい結果を導く傾向にある。Value noise には周期性が無い。

これらが問題にならない場面では value noise も使えると考えられる。実際に使ったことはあまり無いが……

## Classic Perlin Noise

Ken Perlin の実装には、流石に古すぎて現代では通じない部分がある。

- Perm テーブルの長さを 257 にして `& 0xff` を省略するとか、もうしなくていいんじゃないかな。
- 勾配の方向を対角線上に絞っているが（内積計算を簡単にするため）、こういう縛りも必要無いかも。

しかしそれでも、油断するとオリジナルの実装に勝てなかったりする。なんだかんだで CPU 上ではいまだにインストラクション数の絞り込みが重要であるため、ギリギリまで削ぎ落とされた Ken Perlin の実装は、今でもある程度の優位性を持っている。

（もちろん、これらは GPU では通用せず、シェーダー実装するならば、あらゆる箇所を直した方が良い）

## 乱数生成の手法

Gradient Noise では勾配ベクトルの方向を決めるために乱数生成器を使用する。この乱数アルゴリズムは、CPU/GPU のいずれにおいてもパフォーマンスに影響を与えうる要素であり、また見た目にも影響を与えうるため、選択が重要となる。

オリジナルの Perlin Noise は Perm テーブルを使用した古典的な方法で、これは CPU 上では未だに妥当な選択となりうる。ハッシュアルゴリズムでこれを超えるのはなかなか難しい。ただし、GPU 上で実装するにはあまり魅力を感じない。メモリアクセス／フットプリントの両面から欠点が目立つ。

webgl-noise の実装は非常に巧妙でスマートである。選定の背景について[ちゃんと解説が用意されている](https://github.com/stegu/psrdnoise/tree/main/article)のも有り難い。興味深い事実として、この実装は[定数の更新が何度かされている](https://github.com/stegu/webgl-noise/commit/c008e21d3df2ab0b45aaa0c86df4a817ad6b95d4)ことが挙げられる。初期の段階で webgl-noise から派生したコードは、この変更が反映されていなかったりする。


