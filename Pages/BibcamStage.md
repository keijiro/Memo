# BibcamStage (Channel 22)

## システム構成

![Schematics](https://user-images.githubusercontent.com/343936/178990585-e5e53546-8cbe-4033-aa50-d5e13e80ff16.png)

- Windows PC (Ryzen 7 3700X, GeForce RTX 2060 SUPER)
- UPERFECT X Lapdock
- MacBook Pro (M1 Max, Late 2021)
- Novation Launch Control XL
- Komplete Audio 2
- Anker PowerExpand+ 5-in-1 (USB-C ethernet hub)

`BibcamStage` は MacBook 上での動作も可能な仕様だったが、 Unity 側で「Metal 使用時に定期的にスパイクが発生する」という不具合が発生しており、代替として Windows PC を用いざるを得なかった。Windows PC の運用は UPERFECT X の導入でかなり楽になったものの、演者卓の上でこれを展開するのはやはり面倒だった。次回はできれば MBP + MBA の最小構成にまとめたい。

## プロジェクト構成

https://github.com/keijiro/BibcamStage

Unity プロジェクトと Bitwig プロジェクトを含む。

- Bibcam クリップはリポジトリに含まれていない。別途用意して `StreamingAssets` に入れておく必要がある。
- Bitwig に [vzo プラグイン](https://github.com/keijiro/vzo) のインストールが必要。
- Bitwig の標準音源ライブラリが必要。

### プロジェクト依存構成

`BibcamStage` は `BibcamVfx` リポジトリをサブモジュールとして内包している。シーンの基本的な構成要素は `BibcamVfx` の `ThirdPerson` サンプルシーン内に組まれており、 `BibcamStage` ではこれを加算シーンロードしオーバーライド制御する。具体的には、 UI を消してキーボード操作を加えたり、 vzo 信号を受信して FlashGlitch エフェクトを重ねたり、等々。

こういった作りにしたのは、どうせエフェクトのバリエーションを沢山作るのならば、それをそのまま `Bibcam` のサンプルとして流用したい、という思いがあったため。そこで逆に、サンプルを本格的に作り込んでおき、それをそのままパフォーマンスプロジェクトに流用するという構造にした。

サブモジュールからのアセットの取り込みを実現するために、 `BibcamVfx` のアセットはすべて `Packages` ディレクトリに `jp.keijiro.bibcam.vfxgraph.samples` パッケージとして格納した。`BibcamStage` プロジェクトからは `file:` エントリを使ってそのパッケージを取り込んでいる。

この管理手法は想像以上にうまく機能した。今後も同様の手法を使っていくことができるかもしれない。

## Bitwig

オーディオは基本的に全て Grid システム (Note Grid, Poly Grid, FX Grid) を使って生成している。約 40 トラックほど並べて、ミキシングとマスタートラックエフェクトで展開を作っていく。

シーケンスは基本的に Note Grid を使って生成する。各クリップには全音符のみが置かれていて、ノート・オンの間だけシーケンスを生成し続けるような仕組みになっている。これにより、クリップの停止と共にデバイスがスリープされるという連携が実現されている。

マスタートラックには FX Grid 等を使って構築した汎用ビートリピートを噛ませてある。 Kaoss Pad 的な使い方のできるパフォーマンス・エフェクトであり、 Launch Control に操作をアサインしてある。今回はこのビートリピートと、各トラックのミックスと、各クリップの on/off だけでパフォーマンスを完結した。それ以上のパラメーター操作は行っていない。

### 気づいた点

- 40 トラックあってもデバイスが適切にスリープされていればそれほど大きな CPU 負荷にならない。ただし、プロジェクトの初期化（プロジェクトを開いてから再生可能になるまでの遅延）がかなり発生するため、これ以上トラックを増やすのは難しいかもしれない。
- 一部のドラムトラックでは Note Grid ではなく通常のクリップシーケンスを使っている。 Bitwig では Trigger Condition や Probability を使って生成的なシーケンスを構築することもできるため、特にリズム要素ではこのようなアプローチを使った方が手軽な場合も多い。
- 40 トラックもあるため、コントローラーにアサインすることはほぼ不可能。今回はライブでトラックパッド（マウス）操作を行った。ぶっちゃけ単純でやりやすいが、同時に操作できる要素が１つに限定されてしまうなど、制約も多い。もう少し上手い方法を考えたい。
