# Unity Burst Compiler

## Simplex Noise の最適化を行おうとして案外うまくいかなかった体験談

`Unity.Mathematics` から提供されている simplex noise の実装は一貫性に欠けている部分があり（2D ノイズの gradient 版が無いなど）、整理するついでに最適化を行おうと考えたが、これが案外うまくいかなかった。

理由はいくつかある：

- macOS 向け Burst は、現状では Apple Silicon 上での SIMD をサポートしていない。 iOS/Android では条件次第で NEON が使用されるため macOS も同じ要領でいけるかと考えたが、そうでは無かったので拍子抜けしてしまった。このため、SIMD を意識したような処理を書いても普通に FPU 操作になるため、あまり効果が無い。
- 元の実装が案外 CPU 向けに上手く最適化されていた。元の webgl-noise は、 GPU プログラムとしてはやや前時代的な部分があり、必ずしも最適とは言えないが（速いことは速いが、要らん余計なことをしている感がある）。 CPU 向けのコードとしては依然として効果的な実装である。テーブルの導入により僅かな高速化が可能ではあるものの、そこまでせんでもな……という気がしたので止めた。
