# MiniBokeh パッケージ開発における AI コーディングエージェント活用の記録

MiniBokeh パッケージの開発では、立ち上げからリリースまで AI コーディングエージェントを活用した。実用的なプロジェクトにおいてここまで本格的に活用したのは、個人的には初めての事例となる。

使い方としてはだいぶ保守的な手法を採っていて、開発サイクルを全自動で回すようなことは狙わず、逐一作業指示を行なって開発を進めていった。

## 使用ツール

### Claude Code

主にコーディングに用いた。通常の Max プランのため、Opus モデルへのフォールバックが度々発生した。

### Gemini CLI

開発を進める際に URP や SRP Core パッケージの解析が必要になった際に利用した。単純に反応が早くて使いやすいのと、Claude のトークン節約のため。Flash へのフォールバックを避けるために API Key を使用。

### OpenAI Codex

主にドキュメント (README.md) のプルーフリードに利用した。これもトークン節約のため。ChatGPT Plus を契約しているので、実は Codex がコスト面で最も優れているが、反応が遅いため反復作業には向いていない。

## Hex ボケ実装まで

まず、最初の骨組みとなる部分は手作業で作成した。

- Render Graph を使用した Renderer Feature の基本的な実装。
- カメラ側に Controller コンポーネントを付与し、それによってパラメーター制御を行う仕組み。
- Renderer Feature 内に Blit 相当の処理を組み、それによってフルスクリーンエフェクトを適用する。
  - ただし、標準の Blit は単一テクスチャ入力しか対応していないので、Blit はカスタム実装を用いる。
- カスタム Blit 実装に対応したカスタムシェーダー。

ここまでの作業を Claude Code に行わせることも不可能ではないが、未だ Render Graph に関する知見が十分に蓄積されていないため、あまり良いものをスッとは出してくれない。これはまさに「自分で手を動かした方が早い」部分だと思う。


<!--
- 最初の骨組みは手作業で構築。Render Graph を使ったポストプロセスの知見がほぼ存在しないため、これはどうしても自作する必要がありました。
- Hex ボケについては Claude Code を使って論文から C# と HLSL を生成。ただし、Claude Code はレンズブラーが一様サンプリングであることを知らなかったらしく、tent filter を使ったブラーとして組んできたので、その辺りは指導する必要がありました。
- パラメーターの設計については UX が絡むので、実際に手で感覚を確かめながら、相談して修正する必要がありました。
- 最適化も相談しながら実施。今時のモバイルなら単純な loop unroll で十分じゃないか、とのことで、実際にそれで十分な性能が出たので良しとしました。
- 次に複素数カーネルを使った円形ボケを追加。これは Shadertoy のコードと論文を参考資料にして Claude Code で生成。元のコードの解釈の仕方で混乱があったものの、いろいろ試すうちに動くようになりました。
- 円形ボケの処理は MRT でパス数を大幅に減らせるものの、Render Graph + MRT の知見もほぼ存在しないので、この作業は手動で対応。SRP コードの解析を行う際には Gemini CLI を主に使用（レスポンスが速いのと Claude の使用量節約のため）
-->
- エディタコード (Inspector) は Claude Code にほぼ全投げで完成。
- C# / HLSL コードのリファクタリングは Claude Code と手作業が半々ぐらいでした。Claude Code は、作業内容を指示して実行させる（例えば、このクラスのこの機能を別のクラスに移し替えて、とか）には便利ですが、「リファクタリングして」で丸投げすると、かなり筋の悪いことを行うことが多いです。そのため、基本的には手作業でリファクタリングしつつ、まとまった量の面倒な作業が発生した際には Claude に依頼する、と言うような連携を行いました。あと、RenderGraph が絡むコードを扱うのは、やはりだいぶ不得手。そこはほぼ手作業になりました。
- ドキュメントの執筆には Codex (OpenAI/GPT-5) を活用しました。単純に Claude の使用量を節約したかったのと、文章の生成では GPT-5 の方が優れているように感じたためです。ただし、全任せにすると過剰に文章を生成してしまうので、下書きは自分で書くようにしました。
