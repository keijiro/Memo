# ComfyUI

最近は映像制作でも AI モデルを作業工程に組み込むことがあり、そのような場合には ComfyUI が使用ツールの第一候補として挙げられることになる。

## そもそも ComfyUI を使用するべきか？

ComfyUI で行うようなことを Python スクリプトとして vibe coding するのは全く難しくない。無理に ComfyUI を使うよりも vibe coding した方が早いという場合も少なくないだろう。

どちらのアプローチを採るべきかという判断は、使用するモデルやワークフローの内容によっても異なってくるだろう。例えば Stable Diffusion や SDXL, Wan などの人気モデルについては、圧倒的に ComfyUI の利用者数が多いことから、ComfyUI を使用した方がノウハウの流用を行いやすいという側面がある。これに対して、例えば YOLOv8 セグメンテーションを動かすだけ、とかであれば、むしろ vibe coding アプローチの方が手っ取り早いかもしれない。

現状は ComfyUI の調査・勉強を行いたいという欲求もあって ComfyUI を選択するようにしているが、いずれは実利的な判断によって使用ツールを切り分けるようにしたい。

## 使用環境

### ローカル実行

重い生成タスクではなく、比較的軽量なセグメンテーションや識別タスク程度であれば、ローカル環境（自分の場合は MacBook Pro）でも十分に事足りる。GitHub の公式リポジトリを clone してマニュアル通りに動かせば良い。セットアップと実行には一応 `venv` を使っておく。 `pip` で `requirements.txt` を解決すれば、 MPS (Metal) を利用した実行環境が出来上がる。

### サーバー（GPU インスタンス）実行

重い生成タスク（SDXL や Wan など）を動かす場合は、Runpod 上のインスタンスを借りて利用する。ComfyUI 用の テンプレート（Docker イメージのようなもの）が存在しており、一般的な拡張が一通り入った状態から作業を始めることができる。

## 所感

ComfyUI 自体には本当に基本的な機能しか用意されておらず、初期状態ではほとんど何もすることができない。カスタムノードを入れまくってワークフローを構築していくことになる。もはや、カスタムノードをいかに準備して組み合わせるかというのが ComfyUI の本質と言っても良い。

カスタムノードを管理するためのマネージャー的な拡張も存在しており、Runpod のテンプレートでは大抵デフォルトで入っている。自分で環境構築する場合は別に入れなくて良いと思う（自分で git 操作した方が手っ取り早いため）

特に動画を扱うワークフローでは、かなり基本的なことも標準ノードの組み合わせではできなかったりするし、カスタムノードでも使い勝手が想定と違っていて使えないというケースがあったりする。カスタムノードの改造や自作は避けられないと考えるべきだろう。大抵の場合は vibe coding でなんとかなるので、あまり深刻に考える必要は無い。ただそういうことは往々にしてあるので、躊躇せずにやるべき、ということである。

動画ファイルの扱いについては VHS (Video Helper Suite) が定番。
